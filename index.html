<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Grille d'auto-√©valuation</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: Arial, sans-serif; max-width: 800px; margin: auto; padding: 20px; }
    .question { margin-bottom: 15px; }
    .responses { display: flex; gap: 10px; }
    label { display: block; margin-bottom: 5px; }
    select, input[type=text] { width: 100%; padding: 5px; margin-bottom: 10px; }
    button { padding: 10px 20px; margin-top: 20px; }
    .instructions { font-style: italic; margin-bottom: 20px; }
    .subgroup-title { font-weight: bold; margin-top: 30px; margin-bottom: 10px; }
    #finalMessage { display: none; font-size: 18px; font-weight: bold; text-align: center; margin-top: 40px; }
    #welcome { text-align: center; margin-top: 40px; }
    #welcome img { max-width: 200px; margin-bottom: 20px; }
    #questionnaireForm { display: none; }
  </style>
</head>
<body>
  <div id="welcome">
    <img src="static/logo-education.png" alt="Logo Minist√®re" style="float:left; margin-right:15px;">
    <p>
      Ce questionnaire est anonyme, il permet de mieux comprendre certains probl√®mes qui peuvent se passer entre coll√©giens.<br>
      Nous comptons sur toi pour r√©pondre sinc√®rement et te remercions de ton aide.<br><br>
      Tu devras cocher la case qui correspond √† ta r√©ponse en tenant compte de ce qui s'est pass√© depuis le d√©but de l'ann√©e scolaire.
    </p>
    <button onclick="startQuestionnaire()">Commencer</button>
  </div>

  <form id="questionnaireForm">
    <div class="question">
  <label for="nomEleve"><strong>Nom et pr√©nom (facultatif) :</strong></label>
  <input type="text" id="nomEleve" name="nomEleve" placeholder="(Tu peux laisser vide si tu pr√©f√®res)">
</div>
    <h1>Grille d'auto-√©valuation</h1>
    <label>Classe :</label>
    <select name="classe" required>
      <option value="">--Choisir--</option>
      <option>6√®1</option>
      <option>6√®2</option>
      <option>6√®3</option>
      <option>5√®1</option>
      <option>5√®2</option>
      <option>5√®3</option>
      <option>4√®1</option>
      <option>4√®2</option>
      <option>4√®3</option>
      <option>3√®1</option>
      <option>3√®2</option>
      <option>3PM</option>
    </select>

    <label>Sexe :</label>
    <select name="sexe" required>
      <option value="">--Choisir--</option>
      <option>F</option>
      <option>M</option>
      <option>Autre</option>
    </select>

    <label>Ann√©e de naissance :</label>
    <select name="annee" required>
      <option value="">--Choisir--</option>
      <option>2015 ou apr√®s</option>
      <option>2014</option>
      <option>2013</option>
      <option>2012</option>
      <option>2011</option>
      <option>2010 ou avant</option>
    </select>

    <p class="instructions">1 = Jamais &nbsp;&nbsp;&nbsp; 2 = Parfois &nbsp;&nbsp;&nbsp; 3 = Souvent &nbsp;&nbsp;&nbsp; 4 = Tr√®s souvent</p>
    <div id="questions"></div>
    <button type="submit">Envoyer</button>
  </form>

  <div id="finalMessage">
    L‚Äôauto-√©valuation est termin√©e. Merci d‚Äôavoir particip√© !
  </div>

  <script>
    const questionsText = [
  "As-tu peur sur le trajet du coll√®ge √† cause d‚Äôun ou plusieurs √©l√®ves ?",
  "As-tu peur d‚Äôaller au coll√®ge √† cause d‚Äôun ou plusieurs √©l√®ves ?",
  "As-tu menti pour rester chez toi par peur de retrouver un ou plusieurs √©l√®ves au coll√®ge ?",
  "As-tu s√©ch√© les cours √† cause de tes relations avec un ou plusieurs √©l√®ves ?",
  "Tes notes baissent-elles √† cause de ce que tu vis au coll√®ge ?",
  "Te sens-tu d√©motiv√©(e) √† cause de ce que tu vis au coll√®ge ?",
  "As-tu du mal √† faire tes devoirs √† cause de ce que tu vis au coll√®ge ?",
  "As-tu du mal √† t‚Äôendormir ou fais-tu des cauchemars √† cause de ce que tu vis au coll√®ge ?",
  "As-tu mal au ventre ou √† la t√™te √† cause de ce que tu vis au coll√®ge ?",
  "Est-ce que tu te sens triste √† cause de ce que tu vis au coll√®ge ?",
  "Est-ce que tu te sens seul(e) au coll√®ge ?",
  "As-tu peur d‚Äôaller en r√©cr√©ation √† cause d‚Äôun ou plusieurs √©l√®ves ?",
  "Te mets-tu en col√®re ou es-tu agressif(ve) sans savoir pourquoi ?",
  "Es-tu exclu(e) des groupes de travail par un ou plusieurs √©l√®ves ?",
  "As-tu √©t√© mis(e) √† l‚Äô√©cart dans la cour par un ou plusieurs √©l√®ves ?",
  "Manges-tu seul quand tu manges au coll√®ge (class'√©checs, ...) ?",
  "Est-ce qu‚Äôun ou plusieurs √©l√®ves t‚Äôemp√™chent de manger tranquillement au coll√®ge (class'√©checs, ...) ?",
  "Est-ce qu‚Äôun ou plusieurs √©l√®ves se moquent de toi ou t‚Äôinsultent ?",
  "Est-ce qu‚Äôun ou plusieurs √©l√®ves font courir des rumeurs sur toi ?",
  "Est-ce qu‚Äôun ou plusieurs √©l√®ves te rabaissent ou t‚Äôhumilient ?",
  "Est-ce qu‚Äôun ou plusieurs √©l√®ves t‚Äôont d√©j√† menac√©(e) ?",
  "T‚Äôes-tu bagarr√©(e) avec un ou plusieurs √©l√®ves ?",
  "Est-ce qu‚Äôun ou plusieurs √©l√®ves t‚Äôont bouscul√©(e) volontairement ?",
  "As-tu √©t√© agress√©(e) physiquement par un ou plusieurs √©l√®ves ?",
  "Est-ce qu‚Äôun ou plusieurs √©l√®ves t‚Äôont vol√© des affaires ou ont menac√© de le faire ?",
  "As-tu particip√© √† un jeu dangereux √† la demande d‚Äôun ou plusieurs √©l√®ves ?",
  "As-tu √©t√© emb√™t√©(e) aux toilettes ?",
  "Est-ce qu‚Äôon a essay√© de te retirer tes habits ?",
  "As-tu re√ßu des messages insultants ou mena√ßants en ligne ?",
  "Un ou plusieurs √©l√®ves font-ils circuler des photos ou messages sans ton accord ?",
  "Des photos ou vid√©os intimes de toi ont-elles circul√© sans ton accord ?",
  "Tes coordonn√©es ont-elles circul√© sans ton accord ?",
  "Es-tu victime d‚Äôinsultes √† caract√®re sexuel ?",
  "As-tu subi des violences √† caract√®re sexuel ?",
  // Nouveau bloc Oui/Non :
  "Est-ce toujours par le ou les m√™mes √©l√®ves ?",
  "As-tu d√©j√† demand√© de l'aide √† un(e) autre √©l√®ve ?",
  "As-tu d√©j√† demand√© de l'aide √† tes parents ?",
  "As-tu d√©j√† demand√© de l'aide √† un personnel √©ducatif ?",
  // Nouveau bloc Oui/Non :
  "As-tu au moins un(e) ami(e) dans ton √©tablissement ?",
  "Connais-tu le num√©ro de t√©l√©phone contre le harc√®lement 3018 ?",
  "Si oui, as-tu d√©j√† appel√© ou as-tu eu l'intention de le faire ?",
  "As-tu d√©j√†, avec d'autres √©l√®ves, emb√™t√© un(e) autre √©l√®ve en te moquant de lui ou d'elle, en r√©p√©tant des rumeurs √† son sujet, en le ou la bousculant ou en le ou la mettant √† l'√©cart ?",
  "Connais-tu un(e) √©l√®ve harc√©l√©(e) dans ton √©tablissement ?",
  "Connais-tu un(e) √©l√®ve harcel√©(e) dans ta classe ?"
];
    function startQuestionnaire() {
      document.getElementById('welcome').style.display = 'none';
      document.getElementById('questionnaireForm').style.display = 'block';
    }
    function renderQuestions() {
      const container = document.getElementById('questions');
      container.innerHTML = "";
      // Questions Oui/Non : les 4 derni√®res
      const yesNoOptional = [35, 36, 37, 38];
      const yesNoRequired = [39, 40, 41, 42, 43, 44];
      
      questionsText.forEach((question, index) => {
        if (index === 0) {
          const sub1 = document.createElement('div');
          sub1.className = 'subgroup-title';
          sub1.textContent = "Comment te sens-tu ?";
          container.appendChild(sub1);
        } else if (index === 13) {
          const sub2 = document.createElement('div');
          sub2.className = 'subgroup-title';
          sub2.textContent = "Comment cela se passe-t-il avec les autres √©l√®ves ?";
          container.appendChild(sub2);
          } else if (index === 34) {
          // üîπ Cr√©e le titre cliquable du bloc
          const sub3 = document.createElement('div');
          sub3.className = 'subgroup-title';
          sub3.style.cursor = "pointer";
          sub3.style.color = "#0056b3";
          sub3.textContent = "‚ñ∂ Si tu as l‚Äôimpression d‚Äô√™tre emb√™t√©(e) souvent dans ton √©tablissement scolaire ou sur Internet :";

          // üîπ Cr√©e le conteneur pour les questions 35‚Äì38 (cach√© par d√©faut)
          const optionalSection = document.createElement('div');
          optionalSection.id = "optionalQuestions";
          optionalSection.style.display = "none";
          optionalSection.style.marginLeft = "20px";

          // üîπ Quand on clique sur le titre ‚Üí on ouvre / ferme la section
          sub3.addEventListener('click', () => {
          const isVisible = optionalSection.style.display === "block";
          optionalSection.style.display = isVisible ? "none" : "block";
          sub3.textContent = (isVisible ? "‚ñ∂" : "‚ñº") + " Si tu as l‚Äôimpression d‚Äô√™tre emb√™t√©(e) souvent dans ton √©tablissement scolaire ou sur Internet :";
          });

          container.appendChild(sub3);
          container.appendChild(optionalSection);
          } else if (index === 38) {
          const sub4 = document.createElement('div');
          sub4.className = 'subgroup-title';
          sub4.textContent = "Pour en savoir plus :";
          container.appendChild(sub4);
        }
        const div = document.createElement('div');
        div.className = 'question';
        const label = document.createElement('label');
        label.textContent = `${index + 1}. ${question}`;
        div.appendChild(label);
        const responses = document.createElement('div');
        responses.className = 'responses';

        if (yesNoOptional.includes(index + 1) || yesNoRequired.includes(index + 1)) {
          ["Oui", "Non"].forEach(val => {
            const input = document.createElement('input');
            input.type = 'radio';
            input.name = `q${index + 1}`;
            input.value = val;
            if (yesNoRequired.includes(index + 1)) input.required = true;
            const lbl = document.createElement('label');
            lbl.textContent = val;
            lbl.prepend(input);
            responses.appendChild(lbl);
          });
        } else {
        for (let i = 1; i <= 4; i++) {
          const input = document.createElement('input');
          input.type = 'radio';
          input.name = `q${index + 1}`;
          input.value = i;
          input.required = true;
          const lbl = document.createElement('label');
          lbl.textContent = i;
          lbl.prepend(input);
          responses.appendChild(lbl);
        }
      }
        // Ajoute les boutons radio (1-4 ou Oui/Non)
div.appendChild(responses);

// üîπ Si la question fait partie du bloc facultatif (35‚Äì38)
if (index >= 34 && index <= 37) {
  document.getElementById("optionalQuestions")?.appendChild(div);
  return; // On arr√™te ici pour ne pas la remettre dans le flux normal
}

// üîπ Sinon, on l‚Äôajoute normalement dans la page
container.appendChild(div);

      });
    }
    document.getElementById('questionnaireForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const formData = new FormData(e.target);
      const data = {};
      formData.forEach((value, key) => {
        data[key] = value;
      });
      await fetch('/submit', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      });
      document.getElementById('questionnaireForm').style.display = 'none';
      document.getElementById('finalMessage').style.display = 'block';
    });
    renderQuestions();
  </script>
</body>
</html>
